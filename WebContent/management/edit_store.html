<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <title>小易爱车后台管理系统</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" >
    <link href="css/foundation-5.5.3.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
</head>
<body>
  <div class="wrap">
    <div class="header"></div>
    <div class="container">
      <nav class="topNav">
        <div class="right">
          <div class="user_avatar" data-dropdown="hover" data-options="is_hover:true; ">
            <img src="../img/no-avatar.png" alt="">
          </div>
          <ul id="hover" class="f-dropdown" data-dropdown-content>
            <li>
              <a href="">退出</a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="template">
        <div class="breadCrumb">
          <div class="titles left">
            <h3>编辑门店</h3>
            <p class="page_breadcrumbs">
              <a href="index.html">首页</a>
              <i class="fa fa-fw">/</i>
              <a href="store.html">门店管理</a>
              <i class="fa fa-fw">/</i>
              <span>编辑门店</span>
            </p>
          </div>
        </div>
        <div class="mainContent shop_set">
          <div class="row">
            <div class="large-12 columns pd-0">
              <div class="cus_form">
                <div class="data_title">
                  <b>编辑门店</b>
                </div>
                
                <form id='edit_form'>
                <div class="large-8 columns">
                  <div class="row">
                    <div class="large-3 columns">
                    <label class="right inline">
                      <b class="t-color red">*</b>名称：
                    </label>
                  </div>
                  <div class="large-8 end columns">
                    <input type="text" class="radius" name="name" placeholder="请输入名称" value="">
                  </div>
                </div>
                <div class="row">
                  <div class="large-3 columns">
                    <label class="right inline"><b class="t-color red">*</b>电话：</label>
                  </div>
                  <div class="large-8 end columns">
                    <input type="text" class="radius" name="phone" placeholder="请输入电话" value="">
                  </div>
                </div>
                <div class="row">
                  <div class="large-3 columns">
                    <label class="right inline"><b class="t-color red">*</b>地址：</label>
                  </div>
                  <div class="large-8 end columns" id='city_box'>
                    <div class="large-4 columns" style="padding-left:0">
                      <select class="radius prov"  name="province" >
                       </select>
                      </div>

                      <div class="large-4 columns">
                        <select class="radius city" name="city" >
                        </select>
                      </div>
                      <div class="large-4 end columns" style="padding-right:0">
                        <select class="radius dist"  name="region" >
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-3 columns">
                      <label for="" class="right inline"></label>
                    </div>
                    <div class="large-5 columns">
                      <input type="text"  name="address" id="" class="radius" placeholder="请输入具体地址" value="">

                    </div>
                    <div class="large-3 end columns">
                      <a href="javascript:void(0);" class="button postfix geo_bd ran-fix radius" style="border-radius: 3px;">调整定位</a>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-8 large-offset-3 columns">
                      <div style="height: 150px;margin: 0 0 1rem; border:1px solid red"></div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-3 columns">
                      <label class="right inline"><b class="t-color red">*</b>照片：</label>
                    </div>
                    <div class="large-8 end columns">
                      <div class="thumbs_list">
                          <div class="upload_box">
                            <i class="upload_icon"></i>
                            <input type="file" class="upload_button" id='barfile' >
                          </div>
                        <div class="img_preview">
	                        <a class="img_thumbs">
	                        	<img src="" id='barpreview'>
	                        </a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-8 large-offset-3 end columns">
                      <label class="inline form_tips">建议正方形图片</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-3 columns">
                      <label class="right inline"><b class="t-color red">*</b>简介：</label>
                    </div>
                    <div class="large-8 end columns">
                      <textarea class="radius" name="info" placeholder="请填写简介" rows="4"></textarea>
                    </div>
                  </div>
                </div>
                </form>
              </div>
              <div class="row">
                <div class="large-12 text-center columns">
                  <a href="store.html" class="button ran radius back" style="background-color:#fff; color:#2096f3">返回</a>
                  <a id='add_store' class="button ran radius save">修改</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
   <script src="../js/jquery-1.11.3.min.js"></script>
   <script src="../js/pub_fuc.js"></script>
  <script src="js/tether.min.js"></script>
  <script src="js/jquery.components.min.js"></script>
  <script src="js/foundation.min.js"></script>
  <script src="js/public.js"></script>
  <script src="js/common.js"></script>
  <script type="text/javascript" src="../js/jquery.cityselect.js"></script> 
  <script>
      $(function() {
        $("div.header").load("public.html");
        
        $("#barfile").change(function(){
		    readURL(this);
		});
      });
      
      
      var id = get_param('tid');
		
		nativeAjax('get','../api/store/getById?id='+id,function(e){
			var data = jsonParse(getResult(e));
			var code = data.code;
			if(code=='0'){
				var obj = data.data;
				for(var item in obj){
					$(":input[name="+item+"]").val(obj[item]);
				}
				$('#barpreview').attr('src','/freely/store/'+obj.url);
				 $("#city_box").citySelect({  
					    url:"../js/city.min.js",  
					    prov:obj.province, //省份 
					    city:obj.city, //城市 
					    dist:obj.region, //区县 
					    nodata:"none" //当子集无数据时，隐藏select 
					}); 
				 
				 edit_store(obj.url);
			}
			
		});
      
      
      
      
      
      //上次预览
      function readURL(input) {
		if (input.files && input.files[0]) {
		    var reader = new FileReader();
	           reader.onload = function (e) {
		          $('#barpreview').attr('src', e.target.result);
		        }
		        reader.readAsDataURL(input.files[0]);
		 }
	}
      
      function edit_store(url){
	      $('#add_store').click(function(){
	    	  var formData = new FormData(document.getElementById('edit_form'));
	    	  formData.append("file", document.getElementById('barfile').files[0]);
	    	  formData.append("id", id);
	    	  formData.append("url", url);
	    	  
	    	  console.log(formData);
	    	  
	          $.ajax({
	              url: '../api/store/modify',
	              type: 'POST',
	              data: formData,
	              cache: false,
	              contentType: false,
	              processData: false,
	              success: function (data) {
	            	  data = jsonParse(data);
                  	if(data.code=='0'){
                  		window.location.href = 'store.html';
                  	}
	              }
	          });
	          return false;
	      });
    	  
      }
      
      
      	
    </script>
</body>
</html>
