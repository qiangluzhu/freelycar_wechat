<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <title>小易爱车后台管理系统</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" >
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/foundation-5.5.3.min.css" >
    <link rel="stylesheet" type="text/css" href="css/app.css" >
     <link rel="stylesheet" type="text/css" href="../css/bootstrap.css" >
</head>
<body>
  <div class="wrap">
    <div class="header"></div>
    <div class="container">
      <nav class="topNav">
        <div class="right">
          <div class="user_avatar" data-dropdown="hover" data-options="is_hover:true; ">
            <img src="../img/head.png" alt="">
          </div>
          <ul id="hover" class="f-dropdown" data-dropdown-content>
            <li>
              <a href="">退出</a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="template">
        <div class="breadCrumb">
          <div class="titles left">
            <h3>门店管理</h3>
            <p class="page_breadcrumbs">
              <a href="index.html">首页</a>
              <i class="fa fa-fw">/</i>
              <span>门店管理</span>
            </p>
          </div>
          <a href="add_store.html" class="button radius rightConner right">
            <i class="fa fa-plus fa-fw"></i>添加门店
          </a>
        </div>
        <div class="mainContent">
          <div class="modules">
            <div class="row filter_fix">
                <div class="large-2 columns">
                  <input type="text" value=""  id='store_name' placeholder="按门店名称搜索">
                </div>
                <div class="large-2 columns">
                  <input type="text" value="" id='store_address' placeholder="按门店地址搜索">
                </div>
                <div class="large-2 columns">
                  <input type="text" value="" id='store_phone' placeholder="按门店电话搜索">
                </div>
                <div class="large-2 columns end">
                  <a id='con_search' class="button small ran_search">搜索</a>
                </div>
            </div>
            <div class="row">
              <div class="large-12 columns pd-0">
                <table role="grid" class="cus_table">
                  <thead>
                    <tr>
                      <th width="20">序号</th>
                      <th width="80">名称</th>
                      <th width="50">电话</th>
                      <th width="180">地址</th>
                      <th width="100">操作</th>
                    </tr>
                  </thead>
                  <tbody id='content_body'>
                    <!-- <tr>
                      <td>1</td>
                      <td>老蒋车行</td>
                      <td>025-68686868</td>
                      <td>麒麟门啦啦啦路123号</td>
                      <td class="action_columns">
                        <a href="edit_store.html" data-toggle="tooltip" title="编辑" class="inline-button edit"><i class="fa fa-pencil fa-fw"></i></a>
                        <a data-toggle="tooltip" title="删除" class="inline-button del"><i class="fa fa-trash fa-fw"></i></a>
                      </td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td>老刘车行</td>
                      <td>025-78686868</td>
                      <td>鼓楼区中山北路103号B座110</td>
                      <td class="action_columns">
                        <a href="edit_store.html" data-toggle="tooltip" title="编辑" class="inline-button edit"><i class="fa fa-pencil fa-fw"></i></a>
                        <a data-toggle="tooltip" title="删除" class="inline-button del"><i class="fa fa-trash fa-fw"></i></a>
                      </td>
                    </tr> -->
                  </tbody>
                </table>
              </div>
            </div>
            <div class="row">
              <div class="large-12 columns pageination_fix">
                <span class="pagination_count">共<span id='sum_count'></span>条记录 | 每页<span id='page_num'></span>条 </span>
                <ul class="pagination right" id='mypager'>
                  <li class="current sy"><a>首页</a></li>
                  <li class="current syy"><a>上一页</a></li>
                  <li class="current xyy"><a>下一页</a></li>
                  <li class="current wy"><a>尾页</a></li>
				</ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id='confirm_cancel'></div>
  	   <!-- Script -->
   <script src="../js/jquery-1.11.3.min.js"></script>
   <script src="../js/bootstrap.min.js"></script>
  <script src="js/tether.min.js"></script>
  <script src="js/jquery.components.min.js"></script>
  <script src="js/foundation.min.js"></script>
  <script src="js/public.js"></script>
  <script src="js/common.js"></script>
  <script src="../js/pub_fuc.js"></script>
  <script type="text/javascript">
  
$(function(){
	$(".header").load("public.html");
	loadData(1);
});

var store_name ='';
var store_address ='';
var store_phone = '';
var number = 10;
var flag = true;
function loadData(page){
	nativeAjax('get','../api/store/find?name='+store_name+'&address='+store_address+'&phone='+store_phone+'&page='+page+'&number='+number,function(e){
		var data = jsonParse(getResult(e));
		if(data.code!='0'){
			document.getElementById('content_body').innerHTML = '';
			return;
		}
		
		var arr = data.data;
		var html = '';
		for(var i=0,len=arr.length;i<len;i++){
			var obj = arr[i];
			//console.log(obj);
			html +='<tr id='+obj.id+'>'
                +'<td>'+(i+1)+'</td>'
                +'<td>'+obj.name+'</td>'
                +'<td>'+obj.phone+'</td>'
                +'<td>'+obj.address+'</td>'
                +'<td class="action_columns">'
                +'<a data-toggle="tooltip" title="编辑" class="inline-button edit"><i class="fa fa-pencil fa-fw"></i></a>'
                +'<a data-toggle="tooltip" title="删除" class="inline-button del"><i class="fa fa-trash fa-fw"></i></a>'
                +'</td>'
                +'</tr>';
		}
		document.getElementById('content_body').innerHTML = html;
		document.getElementById('sum_count').innerHTML = data.num;
		document.getElementById('page_num').innerHTML = number;
		opera();
		if(flag){
			pagebutton(data.size);
			flag = false;					
		}
	});
}


function opera(){
	$('#content_body').on('click','tr',function(e){
		//filter phone
		var tid  = e.currentTarget.id;
		//console.log(e.target.className);
		if(e.target.className=='fa fa-pencil fa-fw'){
			window.location.href = 'edit_store.html?tid='+tid;
		}
		
		if(e.target.className=='fa fa-trash fa-fw'){
			
			 $("#confirm_cancel").load("confirm_cancel.html",function(){
					$('#myModal').modal('show');
					 $("#myModal").find("button.comfirm").click(function(){
						$('#myModal').modal('hide');
						nativeAjax('get','../api/store/delete?id='+tid,function(e1){
							var data = jsonParse(getResult(e1));
							//console.log(data);
							if(data.code=='0'){
								e.currentTarget.outerHTML ='';
							}
						});
					}); 
					
				}); 
			
		}
	});
	
}


$('#con_search').click(function(){
	 store_name = document.getElementById('store_name').value;
	 store_address = document.getElementById('store_address').value;
	 store_phone = document.getElementById('store_phone').value;
	 loadData(1);
});

</script>
  
</body>
</html>
