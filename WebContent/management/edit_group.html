<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <title>小易爱车后台管理系统</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" >
    <link href="css/foundation-5.5.3.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
</head>
<body>
  <div class="wrap">
    <div class="header"></div>
    <div class="container">
      <nav class="topNav">
        <div class="right">
          <div class="user_avatar" data-dropdown="hover" data-options="is_hover:true; ">
            <img src="https://pic1-s.styd.cn/no-avatar?imageView2/1/w/100/h/100/interlace/1" alt="">
          </div>
          <ul id="hover" class="f-dropdown" data-dropdown-content>
            <li>
              <a href="">退出</a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="template">
        <div class="breadCrumb">
          <div class="titles left">
            <h3>编辑社群</h3>
            <p class="page_breadcrumbs">
              <a href="index.html">首页</a>
              <i class="fa fa-fw">/</i>
              <a href="group.html">社群管理</a>
              <i class="fa fa-fw">/</i>
              <span>编辑社群</span>
            </p>
          </div>
        </div>
        <div class="mainContent shop_set">
          <div class="row">
            <div class="large-12 columns pd-0">
              <div class="cus_form">
                <div class="data_title">
                  <b>编辑社群</b>
                </div>
                <div class="large-8 columns">
                  <div class="row">
                    <div class="large-3 columns">
                      <label class="right inline">
                        <b class="t-color red">*</b>名称：
                      </label>
                    </div>
                    <div class="large-8 end columns">
                      <input type="text" id='name' class="radius" name="store_name" placeholder="请输入名称" value="">
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-3 columns">
                      <label class="right inline"><b class="t-color red">*</b>二维码：</label>
                    </div>
                    <div class="large-8 end columns">
                      <div class="thumbs_list">
                        <form method="POST">
                          <div class="upload_box">
                            <i class="upload_icon"></i>
                            <input type="file" class="upload_button" id='barfile' accept="image/png, image/jpeg, image/gif">
                          </div>
                        </form>
                        <div class="img_preview">
	                        <a class="img_thumbs">
	                        	<img  id='barcode' src="">
	                        </a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-8 large-offset-3 end columns">
                      <label class="inline form_tips">建议正方形图片</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="large-3 columns">
                      <label class="right inline"><b class="t-color red">*</b>简介：</label>
                    </div>
                    <div class="large-8 end columns">
                      <textarea class="radius" id='intro' name="intro" placeholder="请填写简介" rows="4"></textarea>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="large-12 text-center columns">
                  <a href="group.html" class="button ran radius back" style="background-color:#fff; color:#2096f3">返回</a>
                  <a id='edit' class="button ran radius save">修改</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="../js/jquery-1.11.3.min.js"></script>
  <script src="../js/pub_fuc.js"></script>
  <script src="js/tether.min.js"></script>
  <script src="js/jquery.components.min.js"></script>
  <script src="js/foundation.min.js"></script>
  <script src="js/public.js"></script>
  <script src="js/common.js"></script>
    <script>
      $(function() {
         $("div.header").load("public.html");
         $("#barfile").change(function(){
 		    readURL(this);
 		});
      });
      
        var id = get_param('tid');
		nativeAjax('get','../api/community/getById?id='+id,function(e){
			var data = jsonParse(getResult(e));
			//console.log(data);
			var code = data.code;
			if(code=='0'){
				var obj = data.data;
					var name = document.getElementById('name');
					name.value = obj.name;
					
					var intro = document.getElementById('intro');
					intro.innerHTML = obj.intro;
					
					var barcode = document.getElementById('barcode');
					barcode.setAttribute('src','/freely/community/'+obj.url);
	
					edit(obj.url);
			}
			
		});
		
		function edit(url){
			$('#edit').click(function(){
				//nativeAjax('get','../api/community/modify	?id='+id,function(e){},param);
				 var formData = new FormData();
		    	  formData.append('name', document.getElementById('name').value);
		    	  formData.append('intro', document.getElementById('intro').value);
		    	  formData.append('file', document.getElementById('barfile').files[0]);
		    	  formData.append('id', id);
		    	  formData.append('url', url);
				
				
                $.ajax({
                    url: '../api/community/modify',
                    type: 'POST',
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                    	data = jsonParse(data);
                    	console.log(data);
                    	if(data.code=='0'){
                    		window.location.href = 'group.html';
                    	}
                    }
                });
                return false;
			});
		}
		
		
		  //上次预览
	      function readURL(input) {
			if (input.files && input.files[0]) {
			    var reader = new FileReader();
		           reader.onload = function (e) {
			          $('#barcode').attr('src', e.target.result);
			        }
			        reader.readAsDataURL(input.files[0]);
			 }
		}
	      
      
    </script>
</body>
</html>
