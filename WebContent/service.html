<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <title>上门服务</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" >
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>
<body >
	<div class="service hidden" onclick="window.location.href='add_address.html'">
		<div class="address">
			<div class="similar_data_detail" style="margin-bottom:10px;">	
				<span class="name">
					请填写信息
				</span>
			</div>
		</div>
		<span class="icon4 glyphicon glyphicon-map-marker" aria-hidden="true" style="position:absolute"></span>
		<span class="icon5 glyphicon glyphicon-chevron-right" ></span>
	</div>
	<div class="service" onclick="window.location.href='add_address.html'">
		<div class="address">
			<div class="similar_data_detail" style="margin-bottom:10px;">	
				<span class="name" id='name'>
				</span>
				<span class="phone" id='phone'>
				</span>
			</div>
			<div class="similar_data_detail">		
				<p class="store-item-addr3" id='address'>
				</p>
			</div>	
		</div>
		<span class="icon glyphicon glyphicon-map-marker" aria-hidden="true" style="position:absolute"></span>
		<span class="icon2 glyphicon glyphicon-chevron-right" ></span>
	</div>
	<div class="service_time" >
		<div class="similar_data_detail" >		
			<p class="store-item-addr3">
				上门时间<input type="datetime-local" id='ontime'  width="100%"/>
			</p>
			
			<!-- <span class="icon3 glyphicon glyphicon-chevron-right" aria-hidden="true"></span> -->
		</div>
	</div>
	<div class="description" >
		<div class="similar_data_detail">		
			<p class="store-item-addr3">
				情况描述：	
			</p>
			<select id='service_type'>
			</select>
		</div>
	</div>
	<div class="foot_button">
        <div class="submit_button" id='submit_button'>提交</div>
    </div>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="js/pub_fuc.js"></script>
    <script type="text/javascript">
    
    var headimg = get_param('headimg');
	var nickname = get_param('nickname');
	var openId = get_param('openid');
	//var openid  = 'oBaSqs4RpSZNY7czNBcCRF8uYLKI';
	if(isEmpty(headimg)){
		headimg = getCookie('headimg');
	}else{
		setCookie('headimg', headimg);
	}
	
	if(isEmpty(nickname)){
		nickname = getCookie('nickname');
	}else{
		setCookie('nickname', nickname);
	}
	
	if(isEmpty(openId)){
		openId = getCookie('openId');
	}else{
		setCookie('openId', openId);
	}
	 //defaut user info
	// alert(openid);
	 nativeAjax('get','api/user/getAddById?id='+openId,function(e){
			var data = jsonParse(getResult(e));
			if(data.code=='0'){//
				var obj = data.data;
				var short_add = obj.address;
				if(short_add.length>13){
					short_add = short_add.substring(0,13)+'...';		
				}
				document.getElementById('address').innerHTML = short_add;
				document.getElementById('phone').innerHTML = obj.phone;
				document.getElementById('name').innerHTML = obj.name;
				submit(obj);
			}else{
				$('div.service').toggleClass('hidden');
			}
			
	});
	 
	 
	nativeAjax('get','api/stype/find',function(e){
		var data = jsonParse(getResult(e));
		//console.log(data);
		if(data.code!='0'){
			document.getElementById('service_type').innerHTML = '<option value ="">无服务</option>';
			return;
		}
		var arr = data.data;
		var html = '';
		for(var i=0,len=arr.length;i<len;i++){
			var obj = arr[i];
			//console.log(obj);
			html +='<option value ='+obj.info+' >'+obj.info+'</option>';
		}
		document.getElementById('service_type').innerHTML = html;
	});
	 
	 
	 
	 
	 
 	var submit = function(obj){
		$('#submit_button').click(function(){
			//var arr = ['name','license','phone','province','city','region','address'];
			var ontime = document.getElementById('ontime').value;
			if(ontime.indexOf('-')>=0){
				ontime = ontime.split("-").join("/");
			}
			
			if(ontime.indexOf('T')>=0){
				ontime = ontime.split("T").join(" ");
			} 
			
			if(ontime.indexOf('年')>=0){
				ontime = ontime.replace("年","/");
				ontime = ontime.replace("月","/");
				ontime = ontime.replace("日","");
			}
			if(ontime.length>16){
				ontime = ontime.substring(0,16);
			}
			obj.nickName = nickname;
			obj.onTime = ontime;
			obj.remark = document.getElementById('service_type').value;
			obj.ropenId = openId;
			obj.rperson = obj.name;
			var p = $.param(obj);
			nativeAjax('post','api/user/reserve',function(e){
				var data = jsonParse(getResult(e));
				//alert(getResult(e));
				if(data.code=='0'){
					window.location.href ='center.html';
				}else{
					alert(JSON.stringify(data,null,4));
				}
				
			},p); 
			
		});
 		
 	}

	 
    </script>
</body>
</html>
